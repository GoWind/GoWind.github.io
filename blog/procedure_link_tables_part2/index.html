<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.9.1"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/saiyan_sans/Saiyan-Sans.ttf" as="font" type="font/ttf" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://gowind.github.io/blog/procedure_link_tables_part2/"><!-- Primary Meta Tags --><title>Procedure Link Tables Part II</title><meta name="title" content="Procedure Link Tables Part II"><meta name="description" content><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://gowind.github.io/blog/procedure_link_tables_part2/"><meta property="og:title" content="Procedure Link Tables Part II"><meta property="og:description" content><meta property="og:image" content="https://gowind.github.io/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://gowind.github.io/blog/procedure_link_tables_part2/"><meta property="twitter:title" content="Procedure Link Tables Part II"><meta property="twitter:description" content><meta property="twitter:image" content="https://gowind.github.io/blog-placeholder-1.jpg"><!-- Cloudflare Web Analytics --><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;4de85a62d838459fafd8a042c2f1c7c2&quot;}"></script><!-- End Cloudflare Web Analytics --><link rel="stylesheet" href="/js/_slug_.DOYIKLAD.css">
<style>a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}
.scrollrectangle[data-astro-cid-bvzihdzo]{position:fixed;right:20px;width:20px;height:100px;background-color:#2c65d7;border-radius:10%;transition:top .3s ease-out;transform-origin:center center;animation:squeeze 1s infinite}@keyframes squeeze{0%{transform:scaleY(1)}50%{transform:scaleY(1.5)}to{transform:scaleY(1)}}main[data-astro-cid-bvzihdzo]{width:calc(100% - 2em);max-width:100%;margin:0}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{width:720px;max-width:calc(100% - 2em);margin:auto;padding:1em;color:rgb(var(--gray-dark))}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}
</style></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <div class="aura-container" data-astro-cid-3ef6ksr2> <div class="gif-bg-1" data-astro-cid-3ef6ksr2></div> <div class="gif-bg-2" data-astro-cid-3ef6ksr2></div> <div class="gif-bg-3" data-astro-cid-3ef6ksr2></div> <h2 class="aura-text" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2> <span class="yellow" data-astro-cid-3ef6ksr2>Govind's</span> <span class="orange" data-astro-cid-3ef6ksr2>O</span> <span data-astro-cid-3ef6ksr2>Blog</span> </a></h2> </div> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Home </a>  <a href="/blog" class="active" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a>  <a href="/ideas" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Steal My Ideas </a>  <a href="/editor" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Image Editor </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://x.com/DeepknowledgeU" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Follow Astro on X</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://github.com/Gowind" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>My Github</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg> </a> </div> </nav> </header>  <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="scrollrectangle" data-astro-cid-bvzihdzo></div> <script type="module">const o=document.querySelector(".ball"),c=document.querySelector("header"),r=document.documentElement.scrollHeight-window.innerHeight,t=c?.offsetHeight;o.style.top=`${t+100}px`;window.addEventListener("scroll",()=>{const n=window.scrollY/r,l=window.innerHeight-100;let e=n*l;e=e>=t+100?e:t+100,o.style.top=`${e}px`});</script> <div class="hero-image" data-astro-cid-bvzihdzo>  </div> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2022-12-31T00:00:00.000Z"> Dec 31, 2022 </time>  </div> <h1 data-astro-cid-bvzihdzo>Procedure Link Tables Part II</h1> <hr data-astro-cid-bvzihdzo> </div>  <p>This is a continuation of [[From Source Code to Hello World/Procedure Link Tables Part 1]]</p>
<p>Let us fire up good old <code>gdb</code>. I use <code>pwndbg</code>  extension to <code>gdb</code> , as it looks cool and also has some nice additional features (haven’t used it to the full extent, maybe will write a post on that)</p>
<p>In you directory with the <code>main</code> executable ( <code>gcc -c lib.c -o lib.o</code>, <code>gcc -c main.c -o main.o</code>, <code>gcc lib.o main.o -o main</code>), run <code>gdb</code> and load the <code>main</code> file using <code>file main</code>
Let us set a breakpoint in <code>main</code> and step through to understand how <code>printf</code> is called.</p>
<p>If you have <code>pwndbg</code> also installed, your console will look like this</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>pwndbg> file main </span></span>
<span class="line"><span>Reading symbols from main...</span></span>
<span class="line"><span>(No debugging symbols found in main)</span></span>
<span class="line"><span>pwndbg> break main</span></span>
<span class="line"><span>Breakpoint 1 at 0x118a</span></span>
<span class="line"><span>pwndbg></span></span></code></pre>
<p>We have set a <code>breakpoint</code> just before our <code>main</code> fn starts (break is set on <code>main</code> fn, not the executable. Apologies for the confusing naming!)</p>
<p>Type <code>run</code> and press <code>ENTER</code> and you will hit the breakpoint</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>>disas/r</span></span>
<span class="line"><span>Dump of assembler code for function main:</span></span>
<span class="line"><span>=> 0x000055555555518a &#x3C;+0>:     f3 0f 1e fa     endbr64 </span></span>
<span class="line"><span>   0x000055555555518e &#x3C;+4>:     55      push   rbp</span></span>
<span class="line"><span>   0x000055555555518f &#x3C;+5>:     48 89 e5        mov    rbp,rsp</span></span>
<span class="line"><span>   0x0000555555555192 &#x3C;+8>:     48 83 ec 10     sub    rsp,0x10</span></span>
<span class="line"><span>   0x0000555555555196 &#x3C;+12>:    89 7d fc        mov    DWORD PTR [rbp-0x4],edi</span></span>
<span class="line"><span>   0x0000555555555199 &#x3C;+15>:    48 89 75 f0     mov    QWORD PTR [rbp-0x10],rsi</span></span>
<span class="line"><span>   0x000055555555519d &#x3C;+19>:    bf 05 00 00 00  mov    edi,0x5</span></span>
<span class="line"><span>   0x00005555555551a2 &#x3C;+24>:    b8 00 00 00 00  mov    eax,0x0</span></span>
<span class="line"><span>   0x00005555555551a7 &#x3C;+29>:    e8 9d ff ff ff  call   0x555555555149 &#x3C;factorial></span></span>
<span class="line"><span>   0x00005555555551ac &#x3C;+34>:    89 c6   mov    esi,eax</span></span>
<span class="line"><span>   0x00005555555551ae &#x3C;+36>:    48 8d 3d 4f 0e 00 00    lea    rdi,[rip+0xe4f]        # 0x555555556004</span></span>
<span class="line"><span>   0x00005555555551b5 &#x3C;+43>:    b8 00 00 00 00  mov    eax,0x0</span></span>
<span class="line"><span>   0x00005555555551ba &#x3C;+48>:    e8 91 fe ff ff  call   0x555555555050 &#x3C;printf@plt></span></span>
<span class="line"><span>   0x00005555555551bf &#x3C;+53>:    b8 00 00 00 00  mov    eax,0x0</span></span>
<span class="line"><span>   0x00005555555551c4 &#x3C;+58>:    c9      leave  </span></span>
<span class="line"><span>   0x00005555555551c5 &#x3C;+59>:    c3      ret    </span></span>
<span class="line"><span>End of assembler dump.</span></span></code></pre>
<p>Let us set a breakpoint before we call <code>printf@plt</code>. You can set up a breakpoint on an instruction’s address by doing <code>break *addressInHex</code> . Let us set it to
<code>break *0x00005555555551ba</code> and type <code>continue</code>. We will hit our breakpoint</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>   0x5555555551b5 &#x3C;main+43>            mov    eax, 0</span></span>
<span class="line"><span> ► 0x5555555551ba &#x3C;main+48>            call   printf@plt                &#x3C;printf@plt></span></span>
<span class="line"><span>        format: 0x555555556004 ◂— 'factorial of 5 is %d\n'</span></span>
<span class="line"><span>        vararg: 0x78</span></span>
<span class="line"><span> </span></span></code></pre>
<p><code>pwndbg</code> is cool ! It shows the arguments to my <code>printf</code> even, below the instruction. As we can see, we are <code>call</code>-in the <code>printf@plt</code>. Lets step again to see what is going on.</p>
<p><strong>slow here</strong>
Here is the tricky part. It took me some time to identify what is going on here.</p>
<p>Lets do <code>disas/r</code> , it will show us the raw hex values of the assembly instructions instead of the disassembled instructions.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>disas/r</span></span>
<span class="line"><span>....</span></span>
<span class="line"><span>=> 0x00005555555551ba &#x3C;+48>:    e8 91 fe ff ff  call   0x555555555050 &#x3C;printf@plt></span></span>
<span class="line"><span>   0x00005555555551bf &#x3C;+53>:    b8 00 00 00 00  mov    eax,0x0</span></span></code></pre>
<p>Note that we are jumping backward to addres <code>...5050</code>. Let us set a breakpoint there again (<code>break *0x555555555050</code>) and then type <code>continue</code>. we will then stop before address <code>...5050</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>► 0x555555555050 &#x3C;printf@plt>      endbr64 </span></span>
<span class="line"><span>   0x555555555054 &#x3C;printf@plt+4>    bnd jmp qword ptr [rip + 0x2f75]     &#x3C;printf></span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>   0x7ffff7e25d70 &#x3C;printf>          endbr64</span></span></code></pre>
<p>Note the down arrow point to an address much farther than where we set our breakpoint at. Let us look at the raw assembly again</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>pwndbg> disas/r</span></span>
<span class="line"><span>Dump of assembler code for function printf@plt:</span></span>
<span class="line"><span>=> 0x0000555555555050 &#x3C;+0>:     f3 0f 1e fa     endbr64 </span></span>
<span class="line"><span>   0x0000555555555054 &#x3C;+4>:     f2 ff 25 75 2f 00 00    bnd jmp QWORD PTR [rip+0x2f75]        # 0x555555557fd0 &#x3C;printf@got.plt></span></span>
<span class="line"><span>   0x000055555555505b &#x3C;+11>:    0f 1f 44 00 00  nop    DWORD PTR [rax+rax*1+0x0]</span></span></code></pre>
<p>Our next instruction is a <code>jmp QWORD PTR [rip+0x2f75]</code>. When this instruction is executed, <code>rip</code>’s value is  0x000055555555505b. We add 0x2f75 to it (resulting in 0x555555557fd0).</p>
<p>The <code>[]</code> around this addition signified that it is an indirect jump , i.e, we first calculate an address, read the value  <code>a</code> at this address and then jmp <code>a</code>.</p>
<p>So our <code>jmp</code> reads the value at 0x555555557fd0 and then jumps to the value. Inspect the value  at 0x555555557fd0 by typing in <code>x/2x 0x555555557fd0</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0x555555557fd0 &#x3C;printf@got.plt>:        0xf7e25d70      0x00007fff</span></span>
<span class="line"><span>pwndbg></span></span></code></pre>
<p>Since I am running this on my Intel machine, the value is stored in the little-endian format (least significant bytes first). The address should therefore be interpreted as <code>0x00007ffff7e25d70</code> (reverse of what is displayed above)</p>
<p>Note that this matches the value when we hit the breakpoint <code>5050 &#x3C;printf@plt></code> !</p>
<p>This is the real <code>printf</code> !
<strong>And where does this come from ?</strong>
Type in <code>info proc mappings</code>.</p>
<p>This will show you which file /library has been loaded at which address in our process’ address space.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>process 18722</span></span>
<span class="line"><span>Mapped address spaces:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>          Start Addr           End Addr       Size     Offset objfile</span></span>
<span class="line"><span>      0x7ffff7dc1000     0x7ffff7de6000    0x25000        0x0 /usr/lib/x86_64-linux-gnu/libc-2.30.so</span></span>
<span class="line"><span>      0x7ffff7de6000     0x7ffff7f5e000   0x178000    0x25000 /usr/lib/x86_64-linux-gnu/libc-2.30.so</span></span>
<span class="line"><span>      0x7ffff7f5e000     0x7ffff7fa8000    0x4a000   0x19d000 /usr/lib/x86_64-linux-gnu/libc-2.30.so</span></span>
<span class="line"><span>	  ....</span></span>
<span class="line"><span>	  0x7ffff7fae000     0x7ffff7fb4000     0x6000        0x0 </span></span>
<span class="line"><span>      0x7ffff7fcc000     0x7ffff7fcf000     0x3000        0x0 [vvar]</span></span>
<span class="line"><span>      0x7ffff7fcf000     0x7ffff7fd0000     0x1000        0x0 [vdso]</span></span>
<span class="line"><span>      0x7ffff7fd0000     0x7ffff7fd1000     0x1000        0x0 /usr/lib/x86_64-linux-gnu/ld-2.30.so</span></span>
<span class="line"><span>      0x7ffff7fd1000     0x7ffff7ff3000    0x22000     0x1000 /usr/lib/x86_64-linux-gnu/ld-2.30.so</span></span>
<span class="line"><span>      0x7ffff7ff3000     0x7ffff7ffb000     0x8000    0x23000 /usr/lib/x86_64-linux-gnu/ld-2.30.so</span></span>
<span class="line"><span>	  ...</span></span>
<span class="line"><span>      0x7ffff7ffe000     0x7ffff7fff000     0x1000        0x0 </span></span>
<span class="line"><span>      0x7ffffffde000     0x7ffffffff000    0x21000        0x0 [stack]</span></span>
<span class="line"><span>  0xffffffffff600000 0xffffffffff601000     0x1000        0x0 [vsyscall]</span></span>
<span class="line"><span>pwndbg></span></span></code></pre>
<p>The address of the actual printf is in the second entry which points to <code>libc-2.30.so</code> ! This is loading is taken care of by the dynamic linker, which maps portions of <code>libc</code> that we use in our program to the process’s actual address space.</p>
<p>We learnt how <code>PLTs</code> can be used to link to functions whose address we do not know, by creating a stub for them and then stating that we need this stub to be filled with the address to the actual function at runtime.</p>  </div> </article> </main> <footer data-astro-cid-sz7xmlte> <div class="social-links" data-astro-cid-sz7xmlte> <a href="https://x.com/DeepknowledgeU" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Astro on X</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-sz7xmlte><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/Gowind" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>My Github</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> </div> </footer>  </body></html>