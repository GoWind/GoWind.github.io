import{r as g}from"./index.Dy6lLLXr.js";var d={exports:{}},u={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f;function v(){if(f)return u;f=1;var l=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function a(t,s,e){var c=null;if(e!==void 0&&(c=""+e),s.key!==void 0&&(c=""+s.key),"key"in s){e={};for(var i in s)i!=="key"&&(e[i]=s[i])}else e=s;return s=e.ref,{$$typeof:l,type:t,key:c,ref:s!==void 0?s:null,props:e}}return u.Fragment=r,u.jsx=a,u.jsxs=a,u}var R;function p(){return R||(R=1,d.exports=v()),d.exports}var o=p();const E=`
    attribute vec2 a_position;
    attribute vec2 a_texCoord;
    uniform mat3 u_matrix;
    varying vec2 v_texCoord;
    
    void main() {
        vec3 position = u_matrix * vec3(a_position, 1.0);
        gl_Position = vec4(position.xy, 0.0, 1.0);
        v_texCoord = a_texCoord;
    }
`,_=`
    precision mediump float;
    uniform sampler2D u_image;
    varying vec2 v_texCoord;
    
    void main() {
        gl_FragColor = texture2D(u_image, v_texCoord);
    }
`;class T{constructor(r){this.canvas=r}createShader(r,a){const t=this.gl.createShader(r);if(this.gl.shaderSource(t,a),this.gl.compileShader(t),!this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(t));return t}createProgram(r,a){const t=this.gl.createProgram();if(this.gl.attachShader(t,r),this.gl.attachShader(t,a),this.gl.linkProgram(t),!this.gl.getProgramParameter(t,this.gl.LINK_STATUS))throw new Error(this.gl.getProgramInfoLog(t));return t}loadTexture(r){const a=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r),a}calculatePerspectiveMatrix(r,a,t){const s=r*Math.abs(t)*.2,e=t>=0?[[-1,-1],[1,-1],[-1+s/r*2,1],[1-s/r*2,1]]:[[-1,-1],[1,-1],[-1-s/r*2,1],[1+s/r*2,1]],c=e[1][0]-e[0][0],i=e[2][0]-e[0][0],n=e[0][0]-e[1][0]+e[2][0]-e[3][0],m=e[1][1]-e[0][1],x=e[2][1]-e[0][1],h=e[0][1]-e[1][1]+e[2][1]-e[3][1];return[c,i,n,m,x,h,0,0,1]}correct(r,a){if(this.gl=this.canvas.getContext("webgl"),!this.gl)throw new Error("WebGL not supported");this.program=this.createProgram(this.createShader(this.gl.VERTEX_SHADER,E),this.createShader(this.gl.FRAGMENT_SHADER,_)),this.positionLocation=this.gl.getAttribLocation(this.program,"a_position"),this.texCoordLocation=this.gl.getAttribLocation(this.program,"a_texCoord"),this.matrixLocation=this.gl.getUniformLocation(this.program,"u_matrix"),this.imageLocation=this.gl.getUniformLocation(this.program,"u_image"),this.positionBuffer=this.gl.createBuffer(),this.texCoordBuffer=this.gl.createBuffer(),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),this.gl.STATIC_DRAW);const t=this.calculatePerspectiveMatrix(this.canvas.width,this.canvas.height,a);this.loadTexture(r),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.texCoordLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoordBuffer),this.gl.vertexAttribPointer(this.texCoordLocation,2,this.gl.FLOAT,!1,0,0),this.gl.uniformMatrix3fv(this.matrixLocation,!1,t),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}const P=()=>{const[l,r]=g.useState({verticalPerspective:0,horizontalPerspective:0,rotation:0,scale:1}),a=g.useRef(null),t=g.useRef(null),s=g.useRef(null);g.useEffect(()=>{e()},[l]),g.useEffect(()=>{if(t.current){console.log("trying to create perspective correction");let i=t.current.getContext("webgl");console.log("ctx",i),s.current=new T(t.current)}},[t.current]);const e=()=>{const i=t.current,n=a.current;!i||!n||s.current.correct(n,l.verticalPerspective)},c=i=>{const n=i.target.files[0];if(n){const m=new FileReader;m.onload=x=>{const h=new Image;h.onload=()=>{a.current=h,t.current&&(t.current.width=h.width,t.current.height=h.height,e())},h.src=x.target.result},m.readAsDataURL(n)}};return o.jsxs("div",{className:"w-full max-w-2xl mx-auto p-4",children:[o.jsx("input",{type:"file",accept:"image/*",onChange:c}),o.jsx("canvas",{ref:t,className:"border border-gray-300 rounded-lg"}),o.jsxs("div",{className:"mt-4 space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rotation"}),o.jsx("input",{type:"range",min:"-180",max:"180",value:l.rotation,onChange:i=>r(n=>({...n,rotation:Number(i.target.value)})),className:"w-full"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Scale"}),o.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:l.scale,onChange:i=>r(n=>({...n,scale:Number(i.target.value)})),className:"w-full"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Vertical Perspective"}),o.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:l.verticalPerspective,onChange:i=>r(n=>({...n,verticalPerspective:Number(i.target.value)})),className:"w-full"})]}),o.jsx("div",{children:o.jsx("button",{onClick:()=>r(i=>({...i,rotation:0,scale:1})),children:"Reset"})})]})]})};export{P as default};
