import{r as p}from"./index.Dy6lLLXr.js";var E={exports:{}},m={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A;function S(){if(A)return m;A=1;var u=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function o(i,l,t){var n=null;if(t!==void 0&&(n=""+t),l.key!==void 0&&(n=""+l.key),"key"in l){t={};for(var c in l)c!=="key"&&(t[c]=l[c])}else t=l;return l=t.ref,{$$typeof:u,type:i,key:n,ref:l!==void 0?l:null,props:t}}return m.Fragment=e,m.jsx=o,m.jsxs=o,m}var b;function L(){return b||(b=1,E.exports=S()),E.exports}var g=L();const y=`
    attribute vec2 a_position;
    attribute vec2 a_texCoord;
    uniform mat3 u_matrix;
    varying vec2 v_texCoord;
    
    void main() {
        vec3 position = u_matrix * vec3(a_position, 1.0);
        gl_Position = vec4(position.xy / position.z, 0.0, 1.0);
        v_texCoord = a_texCoord;
    }
`,j=`
    precision mediump float;
    uniform sampler2D u_image;
    varying vec2 v_texCoord;
    
    void main() {
        gl_FragColor = texture2D(u_image, v_texCoord);
    }
`;class w{canvas;constructor(e){this.canvas=e}createShader(e,o){const i=this.gl.createShader(e);if(this.gl.shaderSource(i,o),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(i));return i}createProgram(e,o){const i=this.gl.createProgram();if(this.gl.attachShader(i,e),this.gl.attachShader(i,o),this.gl.linkProgram(i),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS))throw new Error(this.gl.getProgramInfoLog(i));return i}loadTexture(e){const o=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,o),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),o}calculatePerspectiveMatrix(e,o,i,l=1,t=0){const n=e*Math.abs(i)*.2,c=[[-1,-1],[1,-1],[-1,1],[1,1]],a=i>=0?[[-1,-1],[1,-1],[-1+n/e*2,1],[1-n/e*2,1]]:[[-1,-1],[1,-1],[-1-n/e*2,1],[1+n/e*2,1]];for(let d=0;d<a.length;d++)a[d][0]*=l,a[d][1]*=l;const h=Math.cos(t),x=Math.sin(t);for(let d=0;d<a.length;d++){const _=a[d][0],T=a[d][1];a[d][0]=_*h-T*x,a[d][1]=_*x+T*h}const r=c.flat(),s=a.flat(),R=[[r[0],r[1],1,0,0,0,-s[0]*r[0],-s[0]*r[1]],[0,0,0,r[0],r[1],1,-s[1]*r[0],-s[1]*r[1]],[r[2],r[3],1,0,0,0,-s[2]*r[2],-s[2]*r[3]],[0,0,0,r[2],r[3],1,-s[3]*r[2],-s[3]*r[3]],[r[4],r[5],1,0,0,0,-s[4]*r[4],-s[4]*r[5]],[0,0,0,r[4],r[5],1,-s[5]*r[4],-s[5]*r[5]],[r[6],r[7],1,0,0,0,-s[6]*r[6],-s[6]*r[7]],[0,0,0,r[6],r[7],1,-s[7]*r[6],-s[7]*r[7]]],v=[s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]],f=this.solveLinearSystem(R,v);return[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],1]}solveLinearSystem(e,o){const i=e.length;for(let t=0;t<i;t++){let n=t;for(let c=t+1;c<i;c++)Math.abs(e[c][t])>Math.abs(e[n][t])&&(n=c);[e[t],e[n]]=[e[n],e[t]],[o[t],o[n]]=[o[n],o[t]];for(let c=t+1;c<i;c++){const a=e[c][t]/e[t][t];for(let h=t;h<i;h++)e[c][h]-=a*e[t][h];o[c]-=a*o[t]}}const l=new Array(i);for(let t=i-1;t>=0;t--){l[t]=o[t]/e[t][t];for(let n=0;n<t;n++)o[n]-=e[n][t]*l[t]}return l}correct(e,o,i=1,l=0){if(this.gl=this.canvas.getContext("webgl"),!this.gl)throw new Error("WebGL not supported");this.program=this.createProgram(this.createShader(this.gl.VERTEX_SHADER,y),this.createShader(this.gl.FRAGMENT_SHADER,j)),this.positionLocation=this.gl.getAttribLocation(this.program,"a_position"),this.texCoordLocation=this.gl.getAttribLocation(this.program,"a_texCoord"),this.matrixLocation=this.gl.getUniformLocation(this.program,"u_matrix"),this.imageLocation=this.gl.getUniformLocation(this.program,"u_image"),this.positionBuffer=this.gl.createBuffer(),this.texCoordBuffer=this.gl.createBuffer(),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),this.gl.STATIC_DRAW);const t=this.calculatePerspectiveMatrix(this.canvas.width,this.canvas.height,o,i,l);this.loadTexture(e),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.texCoordLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoordBuffer),this.gl.vertexAttribPointer(this.texCoordLocation,2,this.gl.FLOAT,!1,0,0),this.gl.uniformMatrix3fv(this.matrixLocation,!1,t),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}const P={display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between"},C={verticalPerspective:0,horizontalPerspective:0,rotation:0,scale:1},U=()=>{const[u,e]=p.useState(C),o=p.useRef(null),i=p.useRef(null),l=p.useRef(null);p.useEffect(()=>{t()},[u]),p.useEffect(()=>{i.current&&(l.current=new w(i.current))},[i.current]);const t=()=>{const a=i.current,h=o.current;!a||!h||l.current.correct(h,u.verticalPerspective,u.scale,u.rotation)},n=(a,h)=>{let x=a/h,r=Math.min(800,a),s=r/x;return{width:r,height:s}},c=a=>{const h=a.target.files[0];if(h){const x=new FileReader;x.onload=r=>{const s=new Image;s.onload=()=>{if(o.current=s,i.current){let{width:R,height:v}=n(s.width,s.height);i.current.width=R,i.current.height=v,e(C),t()}},s.src=r.target.result},x.readAsDataURL(h)}};return g.jsxs(g.Fragment,{children:[g.jsxs("div",{style:{...P,justifyContent:"flex-start",gap:"1rem"},children:[g.jsxs("label",{style:{padding:"3px",backgroundColor:"#4a90e2",color:"white",borderRadius:"2px",cursor:"pointer",display:"inline-block"},children:["Upload Image",g.jsx("input",{type:"file",accept:"image/*",onChange:c,style:{opacity:0,width:"0.1px",height:"0.1px",position:"absolute"}})]}),g.jsx("div",{children:g.jsx("button",{onClick:()=>e(a=>({...a,rotation:0,scale:1})),style:{backgroundColor:"#f44336",textAlign:"center",fontSize:"24px",padding:"4px",borderRadius:"2px"},children:"Reset"})}),g.jsxs("div",{style:P,children:[g.jsx("label",{children:"Rotation"}),g.jsx("input",{type:"range",min:"-180",max:"180",step:"0.1",value:u.rotation,onChange:a=>{e(h=>({...h,rotation:Number(a.target.value)}))},style:{width:"300px"}}),g.jsxs("label",{children:[" ",u.rotation]}),g.jsxs("div",{children:[g.jsx("label",{children:"Scale"}),g.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:u.scale,onChange:a=>e(h=>({...h,scale:Number(a.target.value)})),className:"w-full"})]}),g.jsxs("div",{children:[g.jsx("label",{children:"Vertical Perspective"}),g.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:u.verticalPerspective,onChange:a=>e(h=>({...h,verticalPerspective:Number(a.target.value)})),className:"w-full"})]})]})]}),g.jsx("canvas",{ref:i,className:"border border-gray-300 rounded-lg"})]})};export{U as default};
