import{r as x}from"./index.Dy6lLLXr.js";var v={exports:{}},d={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _;function b(){if(_)return d;_=1;var u=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function a(i,h,t){var l=null;if(t!==void 0&&(l=""+t),h.key!==void 0&&(l=""+h.key),"key"in h){t={};for(var s in h)s!=="key"&&(t[s]=h[s])}else t=h;return h=t.ref,{$$typeof:u,type:i,key:l,ref:h!==void 0?h:null,props:t}}return d.Fragment=r,d.jsx=a,d.jsxs=a,d}var T;function L(){return T||(T=1,v.exports=b()),v.exports}var c=L();const C=`
    attribute vec2 a_position;
    attribute vec2 a_texCoord;
    uniform mat3 u_matrix;
    varying vec2 v_texCoord;
    
    void main() {
        vec3 position = u_matrix * vec3(a_position, 1.0);
        gl_Position = vec4(position.xy / position.z, 0.0, 1.0);
        v_texCoord = a_texCoord;
    }
`,S=`
    precision mediump float;
    uniform sampler2D u_image;
    varying vec2 v_texCoord;
    
    void main() {
        gl_FragColor = texture2D(u_image, v_texCoord);
    }
`;class F{canvas;constructor(r){this.canvas=r}createShader(r,a){const i=this.gl.createShader(r);if(this.gl.shaderSource(i,a),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(i));return i}createProgram(r,a){const i=this.gl.createProgram();if(this.gl.attachShader(i,r),this.gl.attachShader(i,a),this.gl.linkProgram(i),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS))throw new Error(this.gl.getProgramInfoLog(i));return i}loadTexture(r){const a=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r),a}calculatePerspectiveMatrix(r,a,i,h=1,t=0){const l=r*Math.abs(i)*.2,s=[[-1,-1],[1,-1],[-1,1],[1,1]],o=i>=0?[[-1,-1],[1,-1],[-1+l/r*2,1],[1-l/r*2,1]]:[[-1,-1],[1,-1],[-1-l/r*2,1],[1+l/r*2,1]];for(let g=0;g<o.length;g++)o[g][0]*=h,o[g][1]*=h;const m=Math.cos(t),R=Math.sin(t);for(let g=0;g<o.length;g++){const p=o[g][0],E=o[g][1];o[g][0]=p*m-E*R,o[g][1]=p*R+E*m}const e=s.flat(),n=o.flat(),A=[[e[0],e[1],1,0,0,0,-n[0]*e[0],-n[0]*e[1]],[0,0,0,e[0],e[1],1,-n[1]*e[0],-n[1]*e[1]],[e[2],e[3],1,0,0,0,-n[2]*e[2],-n[2]*e[3]],[0,0,0,e[2],e[3],1,-n[3]*e[2],-n[3]*e[3]],[e[4],e[5],1,0,0,0,-n[4]*e[4],-n[4]*e[5]],[0,0,0,e[4],e[5],1,-n[5]*e[4],-n[5]*e[5]],[e[6],e[7],1,0,0,0,-n[6]*e[6],-n[6]*e[7]],[0,0,0,e[6],e[7],1,-n[7]*e[6],-n[7]*e[7]]],P=[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]],f=this.solveLinearSystem(A,P);return[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],1]}solveLinearSystem(r,a){const i=r.length;for(let t=0;t<i;t++){let l=t;for(let s=t+1;s<i;s++)Math.abs(r[s][t])>Math.abs(r[l][t])&&(l=s);[r[t],r[l]]=[r[l],r[t]],[a[t],a[l]]=[a[l],a[t]];for(let s=t+1;s<i;s++){const o=r[s][t]/r[t][t];for(let m=t;m<i;m++)r[s][m]-=o*r[t][m];a[s]-=o*a[t]}}const h=new Array(i);for(let t=i-1;t>=0;t--){h[t]=a[t]/r[t][t];for(let l=0;l<t;l++)a[l]-=r[l][t]*h[t]}return h}correct(r,a,i=1,h=0){if(this.gl=this.canvas.getContext("webgl"),!this.gl)throw new Error("WebGL not supported");this.program=this.createProgram(this.createShader(this.gl.VERTEX_SHADER,C),this.createShader(this.gl.FRAGMENT_SHADER,S)),this.positionLocation=this.gl.getAttribLocation(this.program,"a_position"),this.texCoordLocation=this.gl.getAttribLocation(this.program,"a_texCoord"),this.matrixLocation=this.gl.getUniformLocation(this.program,"u_matrix"),this.imageLocation=this.gl.getUniformLocation(this.program,"u_image"),this.positionBuffer=this.gl.createBuffer(),this.texCoordBuffer=this.gl.createBuffer(),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),this.gl.STATIC_DRAW);const t=this.calculatePerspectiveMatrix(this.canvas.width,this.canvas.height,a,i,h);this.loadTexture(r),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.texCoordLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoordBuffer),this.gl.vertexAttribPointer(this.texCoordLocation,2,this.gl.FLOAT,!1,0,0),this.gl.uniformMatrix3fv(this.matrixLocation,!1,t),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}const j=()=>{const[u,r]=x.useState({verticalPerspective:0,horizontalPerspective:0,rotation:0,scale:1}),a=x.useRef(null),i=x.useRef(null),h=x.useRef(null);x.useEffect(()=>{t()},[u]),x.useEffect(()=>{i.current&&(h.current=new F(i.current))},[i.current]);const t=()=>{const s=i.current,o=a.current;!s||!o||h.current.correct(o,u.verticalPerspective,u.scale,u.rotation)},l=s=>{const o=s.target.files[0];if(o){const m=new FileReader;m.onload=R=>{const e=new Image;e.onload=()=>{a.current=e,i.current&&(i.current.width=e.width,i.current.height=e.height,t())},e.src=R.target.result},m.readAsDataURL(o)}};return c.jsxs("div",{className:"w-full max-w-2xl mx-auto p-4",children:[c.jsx("input",{type:"file",accept:"image/*",onChange:l}),c.jsx("canvas",{ref:i,className:"border border-gray-300 rounded-lg"}),c.jsxs("div",{className:"mt-4 space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rotation"}),c.jsx("input",{type:"range",min:"-180",max:"180",value:u.rotation,onChange:s=>r(o=>({...o,rotation:Number(s.target.value)})),className:"w-full"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium mb-1",children:"Scale"}),c.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:u.scale,onChange:s=>r(o=>({...o,scale:Number(s.target.value)})),className:"w-full"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium mb-1",children:"Vertical Perspective"}),c.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:u.verticalPerspective,onChange:s=>r(o=>({...o,verticalPerspective:Number(s.target.value)})),className:"w-full"})]}),c.jsx("div",{children:c.jsx("button",{onClick:()=>r(s=>({...s,rotation:0,scale:1})),children:"Reset"})})]})]})};export{j as default};
