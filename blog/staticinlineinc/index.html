<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.9.1"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/saiyan_sans/Saiyan-Sans.ttf" as="font" type="font/ttf" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://gowind.github.io/blog/staticinlineinc/"><!-- Primary Meta Tags --><title>Static Inline in C</title><meta name="title" content="Static Inline in C"><meta name="description" content="Function storage classifiers in C"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://gowind.github.io/blog/staticinlineinc/"><meta property="og:title" content="Static Inline in C"><meta property="og:description" content="Function storage classifiers in C"><meta property="og:image" content="https://gowind.github.io/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://gowind.github.io/blog/staticinlineinc/"><meta property="twitter:title" content="Static Inline in C"><meta property="twitter:description" content="Function storage classifiers in C"><meta property="twitter:image" content="https://gowind.github.io/blog-placeholder-1.jpg"><!-- Cloudflare Web Analytics --><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;4de85a62d838459fafd8a042c2f1c7c2&quot;}"></script><!-- End Cloudflare Web Analytics --><style>:root{--accent: #2337ff;--accent-dark: #000d8a;--black: 15, 18, 25;--gray: 96, 115, 159;--gray-light: 229, 233, 240;--gray-dark: 34, 41, 57;--gray-gradient: rgba(var(--gray-light), 50%), #fff;--box-shadow: 0 2px 6px rgba(var(--gray), 25%), 0 8px 24px rgba(var(--gray), 33%), 0 16px 32px rgba(var(--gray), 33%)}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-bold.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}@font-face{font-family:SaiyanSans;src:url(/js/Saiyan-Sans.HVcRaXbq.ttf) format("truetype");font-weight:400;font-style:normal;font-display:swap}body{font-family:Atkinson,sans-serif;margin:0;padding:0;text-align:left;background:linear-gradient(var(--gray-gradient)) no-repeat;background-size:100% 600px;word-wrap:break-word;overflow-wrap:break-word;color:rgb(var(--gray-dark));font-size:20px;line-height:1.7}main{width:720px;max-width:calc(100% - 2em);margin:auto;padding:3em 1em}h1,h2,h3,h4,h5,h6{margin:0 0 .5rem;color:rgb(var(--black));line-height:1.2}h1{font-size:3.052em}h2{font-size:2.441em}h3{font-size:1.953em}h4{font-size:1.563em}h5{font-size:1.25em}strong,b{font-weight:700}a,a:hover{color:var(--accent)}p{margin-bottom:1em}.prose p{margin-bottom:2em}textarea{width:100%;font-size:16px}input{font-size:16px}table{width:100%}img{max-width:100%;height:auto;border-radius:8px}code{padding:2px 5px;background-color:rgb(var(--gray-light));border-radius:2px}pre{padding:1.5em;border-radius:8px}pre>code{all:unset}blockquote{border-left:4px solid var(--accent);padding:0 0 0 20px;margin:0;font-size:1.333em}hr{border:none;border-top:1px solid rgb(var(--gray-light))}@media (max-width: 720px){body{font-size:18px}main{padding:1em}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}.tag{display:inline-block;background-color:#f3f4f6;border-radius:.5rem;padding:.25rem .75rem;margin:0 .5rem .5rem 0;font-size:.875rem;font-weight:600;color:#4b5563}header[data-astro-cid-3ef6ksr2]{margin:0;padding:0 1em;background:#fff;box-shadow:0 2px 8px rgba(var(--black),5%)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:baseline;justify-content:space-between}.internal-links[data-astro-cid-3ef6ksr2]{font-family:SaiyanSans,sans-serif;font-spacing:1em;font-size:2rem}nav[data-astro-cid-3ef6ksr2] .internal-links[data-astro-cid-3ef6ksr2]{margin-right:10em}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--black);border-bottom:4px solid transparent;text-decoration:none}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]:hover{color:var(--accent);color:red;animation:shake .2s;animation-iteration-count:1;text-shadow:2px 4px rgba(0,0,0,.2);font-weight:bolder}@keyframes shake{0%{transform:translate(1px,1px) rotate(0)}10%{transform:translate(-1px,-2px) rotate(-5deg)}20%{transform:translate(-3px) rotate(5deg)}30%{transform:translate(3px,2px) rotate(0)}40%{transform:translate(1px,-1px) rotate(5deg)}50%{transform:translate(-1px,2px) rotate(-5deg)}60%{transform:translate(-3px,1px) rotate(0)}70%{transform:translate(3px,1px) rotate(-5deg)}80%{transform:translate(-1px,-1px) rotate(5deg)}90%{transform:translate(1px,2px) rotate(0)}to{transform:translate(1px,-2px) rotate(-5deg)}}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:red}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}.aura-container[data-astro-cid-3ef6ksr2]{position:relative;display:inline-block;padding:60px}.aura-text[data-astro-cid-3ef6ksr2]{font-size:2.2rem;font-weight:700;font-family:SaiyanSans,sans-serif;color:red;position:relative;z-index:4;-webkit-text-stroke:1px black;letter-spacing:.1em}.aura-text[data-astro-cid-3ef6ksr2] .yellow[data-astro-cid-3ef6ksr2]{color:#ff0}.aura-text[data-astro-cid-3ef6ksr2] .organge[data-astro-cid-3ef6ksr2]{color:orange}.gif-aura[data-astro-cid-3ef6ksr2]{position:absolute;inset:0;background:url(/CFoa1-speed.gif) center/cover no-repeat;z-index:2;mix-blend-mode:screen;opacity:.8}.gif-bg-1[data-astro-cid-3ef6ksr2],.gif-bg-2[data-astro-cid-3ef6ksr2],.gif-bg-3[data-astro-cid-3ef6ksr2],.gif-bg-4[data-astro-cid-3ef6ksr2],.gif-bg-5[data-astro-cid-3ef6ksr2],.gif-bg-6[data-astro-cid-3ef6ksr2],.gif-bg-7[data-astro-cid-3ef6ksr2],.gif-bg-8[data-astro-cid-3ef6ksr2]{position:absolute;width:150px;height:150px;background:url(/CFoa1-speed.gif) center/contain no-repeat;z-index:4;mix-blend-mode:multiply;opacity:.9}.gif-bg-1[data-astro-cid-3ef6ksr2]{top:-5px;left:-5px;transform:rotate(-20deg)}.gif-bg-2[data-astro-cid-3ef6ksr2]{top:-5px;left:25%;transform:rotate(-5deg)}.gif-bg-3[data-astro-cid-3ef6ksr2]{top:-5px;left:50%;transform:rotate(5deg)}.gif-bg-4[data-astro-cid-3ef6ksr2]{top:-15px;right:-30px;transform:rotate(20deg)}.gif-bg-5[data-astro-cid-3ef6ksr2]{bottom:10px;left:-30px;transform:rotate(-160deg)}.gif-bg-6[data-astro-cid-3ef6ksr2]{bottom:10px;left:25%;transform:rotate(-160deg)}.gif-bg-7[data-astro-cid-3ef6ksr2]{bottom:10px;right:25%;transform:rotate(-160deg)}.gif-bg-8[data-astro-cid-3ef6ksr2]{bottom:10px;right:-30px;transform:rotate(160deg)}
a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}
.scrollrectangle[data-astro-cid-bvzihdzo]{position:fixed;right:20px;width:20px;height:100px;background-color:#2c65d7;border-radius:10%;transition:top .3s ease-out;transform-origin:center center;animation:squeeze 1s infinite}@keyframes squeeze{0%{transform:scaleY(1)}50%{transform:scaleY(1.5)}to{transform:scaleY(1)}}main[data-astro-cid-bvzihdzo]{width:calc(100% - 2em);max-width:100%;margin:0}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{width:720px;max-width:calc(100% - 2em);margin:auto;padding:1em;color:rgb(var(--gray-dark))}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}
</style></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <div class="aura-container" data-astro-cid-3ef6ksr2> <div class="gif-bg-1" data-astro-cid-3ef6ksr2></div> <div class="gif-bg-2" data-astro-cid-3ef6ksr2></div> <div class="gif-bg-3" data-astro-cid-3ef6ksr2></div> <h2 class="aura-text" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2> <span class="yellow" data-astro-cid-3ef6ksr2>Govind's</span> <img src="/dragonball.jpg" width="30px" height="30px" data-astro-cid-3ef6ksr2> <span data-astro-cid-3ef6ksr2>Blog</span> </a></h2> </div> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Home </a>  <a href="/blog" class="active" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a>  <a href="/ideas" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Steal My Ideas </a>  <a href="/editor" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Image Editor </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://x.com/DeepknowledgeU" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Follow Astro on X</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://github.com/Gowind" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>My Github</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg> </a> </div> </nav> </header>  <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="scrollrectangle" data-astro-cid-bvzihdzo></div> <script type="module">const o=document.querySelector(".ball"),c=document.querySelector("header"),r=document.documentElement.scrollHeight-window.innerHeight,t=c?.offsetHeight;o.style.top=`${t+100}px`;window.addEventListener("scroll",()=>{const n=window.scrollY/r,l=window.innerHeight-100;let e=n*l;e=e>=t+100?e:t+100,o.style.top=`${e}px`});</script> <div class="hero-image" data-astro-cid-bvzihdzo>  </div> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2025-08-25T22:00:00.000Z"> Aug 26, 2025 </time>  </div> <h1 data-astro-cid-bvzihdzo>Static Inline in C</h1> <hr data-astro-cid-bvzihdzo> </div>  <p>Today, I learnt of an interesting technique in C to share function definitions via a header file without causing conflicts</p>
<p>Lets take the example of a shared function that is defined in a header file</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#E1E4E8">$ cat h.h</span></span>
<span class="line"><span style="color:#F97583">#ifndef</span><span style="color:#B392F0"> _H_H</span></span>
<span class="line"><span style="color:#F97583">#define</span><span style="color:#B392F0"> _H_H</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#B392F0"> adderh</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> a</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> b</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583"> return</span><span style="color:#E1E4E8"> a </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#F97583">#endif</span></span></code></pre>
<p>I use the function <code>adderh</code> in 2 different C files (also called translation units)</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#E1E4E8">$ cat m.c</span></span>
<span class="line"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> "h.h"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#B392F0"> multiplier</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> a</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> b</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#B392F0"> adderh</span><span style="color:#E1E4E8">(a, b) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 23</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">~/</span><span style="color:#E1E4E8">personal ⌚ </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">39</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">37</span></span>
<span class="line"><span style="color:#E1E4E8">$ cat n.c</span></span>
<span class="line"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> "h.h"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#B392F0"> divider</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> a</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> b</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#B392F0"> adderh</span><span style="color:#E1E4E8">(a, b) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 12</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>I then use the multiplier and the divider function from my <code>main</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#E1E4E8">$ cat main.c</span></span>
<span class="line"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> &#x3C;unistd.h></span></span>
<span class="line"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> &#x3C;stdio.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">extern</span><span style="color:#F97583"> int</span><span style="color:#B392F0"> multiplier</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> a</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> b</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">extern</span><span style="color:#F97583"> int</span><span style="color:#B392F0"> divider</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> a</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> b</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#B392F0">  printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">divider</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">multiplier</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">45</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">33</span><span style="color:#E1E4E8">), </span><span style="color:#79B8FF">67</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>The <code>extern</code> qualifier in <code>main</code> tells that these 2 fns are supplied by other object files or libraries that will be linked into the final executable. And indeed, I will link <code>m.c</code> and <code>n.c</code> into the final executable so:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> gcc</span><span style="color:#9ECBFF"> m.c</span><span style="color:#9ECBFF"> n.c</span><span style="color:#9ECBFF"> main.c</span><span style="color:#79B8FF"> -o</span><span style="color:#9ECBFF"> main</span></span>
<span class="line"><span style="color:#B392F0">duplicate</span><span style="color:#9ECBFF"> symbol</span><span style="color:#9ECBFF"> '_adderh'</span><span style="color:#9ECBFF"> in:</span></span>
<span class="line"><span style="color:#B392F0">    /private/var/folders/g5/6bsr90hd0xzg64415zgm1fxc0000gp/T/m-61ac34.o</span></span>
<span class="line"><span style="color:#B392F0">    /private/var/folders/g5/6bsr90hd0xzg64415zgm1fxc0000gp/T/n-612007.o</span></span>
<span class="line"><span style="color:#B392F0">ld:</span><span style="color:#79B8FF"> 1</span><span style="color:#9ECBFF"> duplicate</span><span style="color:#9ECBFF"> symbols</span></span></code></pre>
<p>Oh, what just happened ? Why is the linker complaining that there are 2 <code>_adderh</code> symbols ?</p>
<p>Header files are handled by the preprocessor. Think of them as rendering HTML templates. When you <code>#include "somelibrary.h</code> in your C file, the compiler will first expand the contents of the header INTO the <code>.c</code> file (a copy of it actually) before compiling and linking your code into the final excutable / object file. We can see how this happens by using the gcc with the <code>-E</code> flag</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#E1E4E8">$ gcc </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">E m.c</span></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#B392F0"> adderh</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> a</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> b</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583"> return</span><span style="color:#E1E4E8"> a </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#B392F0"> multiplier</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> a</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> b</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#B392F0"> adderh</span><span style="color:#E1E4E8">(a, b) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 23</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>So our <code>m.c</code> has 2 fns, one that is defined in the header expanded into our code and the original multiplier fn. Likewise the same happens for <code>n.c</code> as well.</p>
<p>Therefor when we link <code>m.c</code> and <code>n.c</code> into <code>main</code>, our compiler sees  2 <code>adderh</code> symbols which breaks the <a href="https://en.cppreference.com/w/cpp/language/definition.html">One Definition Rule</a> that says that there must be only one definition for a given symbol (in our case, the <code>adderh</code> function)</p>
<p>We can try to solve this problem by making a function <code>static</code>. The <code>static</code> qualifier for a function makes it <code>local</code> to a translation unit. This means that the fn qualified with <code>static</code> is private to the translation unit and is not exported (in Javascript terms) to other translation units.</p>
<p>We can check this by compiling <code>m.c</code> to an object file and checking the list of exported or <code>global</code> symbols</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#E1E4E8">$ cat h.h</span></span>
<span class="line"><span style="color:#F97583">#ifndef</span><span style="color:#B392F0"> _H_H</span></span>
<span class="line"><span style="color:#F97583">#define</span><span style="color:#B392F0"> _H_H</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">static</span><span style="color:#F97583"> int</span><span style="color:#B392F0"> adderh</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> a</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> b</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583"> return</span><span style="color:#E1E4E8"> a </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> b </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#F97583">#endif</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">gcc</span><span style="color:#79B8FF"> -c</span><span style="color:#9ECBFF"> m.c</span></span>
<span class="line"><span style="color:#B392F0">nm</span><span style="color:#79B8FF"> -g</span><span style="color:#9ECBFF"> m.o</span></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> nm</span><span style="color:#79B8FF"> -g</span><span style="color:#9ECBFF"> m.o</span></span>
<span class="line"><span style="color:#B392F0">0000000000000000</span><span style="color:#9ECBFF"> T</span><span style="color:#9ECBFF"> _multiplier</span></span></code></pre>
<p>The <code>nm</code> tool listed the symbols of an object file and <code>-g</code> lists only the <code>global</code> symbols. We can see that only the <code>multiplier</code> function is exported/<code>global</code> in our <code>m.o</code></p>
<p>The same happens with <code>n.c</code> as well.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> gcc</span><span style="color:#79B8FF"> -c</span><span style="color:#9ECBFF"> n.c</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">~</span><span style="color:#E1E4E8">/personal ⌚ 2:00:39</span></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> nm</span><span style="color:#79B8FF"> -g</span><span style="color:#9ECBFF"> n.o</span></span>
<span class="line"><span style="color:#B392F0">0000000000000000</span><span style="color:#9ECBFF"> T</span><span style="color:#9ECBFF"> _divider</span></span></code></pre>
<p>Now that <code>adderh</code> is not exported by either object files, we can link them into our final executables without confusing our linker thus successfully creating our final executable</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> gcc</span><span style="color:#9ECBFF"> m.c</span><span style="color:#9ECBFF"> n.c</span><span style="color:#9ECBFF"> main.c</span><span style="color:#79B8FF"> -o</span><span style="color:#9ECBFF"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">~</span><span style="color:#E1E4E8">/personal ⌚ 2:01:04</span></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> ./main</span></span>
<span class="line"><span style="color:#B392F0">190955</span></span></code></pre>
<p>It is also common in many codebases to find the static qualifier accompanied by an <code>inline</code> qualifier:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>static int adderh(int a, int b) {</span></span>
<span class="line"><span> return a * b + 2;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>#endif</span></span></code></pre>
<p>The <code>inline</code> qualifier is a hint to the compiler to inline the fn into the calling function. In certain cases such as when optimization flags are enabled, or when the compiler decides to optimize code, the call to the adderh in the multipler fn for example</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>int multiplier(int a, int b) {</span></span>
<span class="line"><span>  return adderh(a, b) * 23;</span></span>
<span class="line"><span>}</span></span></code></pre>
<p>is replaced by the definition of the adderh fn itself</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>int multiplier(int a, int b) {</span></span>
<span class="line"><span>  return ( (a + b) * 2) * 23;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Eliminating fn calls can often lead to massive improvements in performance as the overhead of calling a fn can often be larger than the actual instructions carried out by the fn. </span></span>
<span class="line"><span></span></span>
<span class="line"><span>To a sharp eyed observer, tt might look like `inline` itself should be sufficient to avoid our initial problem: that of having multiple adderh symbols because the adderh fn itself is erased from our object files. Shouldn't that work ? </span></span>
<span class="line"><span></span></span>
<span class="line"><span>```shell</span></span>
<span class="line"><span>$ gcc m.c n.c main.c -o main</span></span>
<span class="line"><span>Undefined symbols for architecture arm64:</span></span>
<span class="line"><span>  "_adderh", referenced from:</span></span>
<span class="line"><span>      _multiplier in m-8a72fd.o</span></span>
<span class="line"><span>      _divider in n-34f18b.o</span></span>
<span class="line"><span>ld: symbol(s) not found for architecture arm64</span></span>
<span class="line"><span>clang: error: linker command failed with exit code 1 (use -v to see invocation)</span></span></code></pre>
<p>Oh, no ! What happened ?
Turns out the <code>inline</code> qualifier is actually just a hint to the compiler. The compiler may decide to inline the fn or it can decide not to.
When I compile <code>m.c</code> to an object file with an <code>inline adderh</code> fn, the <code>adderh</code> symbol is marked as <code>undefined</code>, thus leavin to the linker to
figure out how to find and link an adderh definition into the final executable.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> gcc</span><span style="color:#79B8FF"> -c</span><span style="color:#9ECBFF"> m.c</span></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> nm</span><span style="color:#9ECBFF"> m.o</span></span>
<span class="line"><span style="color:#B392F0">                 U</span><span style="color:#9ECBFF"> _adderh</span></span>
<span class="line"><span style="color:#B392F0">0000000000000000</span><span style="color:#9ECBFF"> T</span><span style="color:#9ECBFF"> _multiplier</span></span>
<span class="line"><span style="color:#B392F0">0000000000000000</span><span style="color:#9ECBFF"> t</span><span style="color:#9ECBFF"> ltmp0</span></span>
<span class="line"><span style="color:#B392F0">0000000000000038</span><span style="color:#9ECBFF"> s</span><span style="color:#9ECBFF"> ltmp1</span></span></code></pre>
<p>However if I enable optimizations with an <code>-O2</code> flag, I can see that the adderh function is inlined into the <code>multiplier</code> fn</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> gcc</span><span style="color:#79B8FF"> -c</span><span style="color:#79B8FF"> -O2</span><span style="color:#9ECBFF"> m.c</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">~</span><span style="color:#E1E4E8">/personal ⌚ 2:20:13</span></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> nm</span><span style="color:#9ECBFF"> m.o</span></span>
<span class="line"><span style="color:#B392F0">0000000000000000</span><span style="color:#9ECBFF"> T</span><span style="color:#9ECBFF"> _multiplier</span></span>
<span class="line"><span style="color:#B392F0">0000000000000000</span><span style="color:#9ECBFF"> t</span><span style="color:#9ECBFF"> ltmp0</span></span>
<span class="line"><span style="color:#B392F0">0000000000000018</span><span style="color:#9ECBFF"> s</span><span style="color:#9ECBFF"> ltmp1</span></span></code></pre>
<p>Thus static inline ensures 2 things</p>
<ol>
<li>A shared fn defined in a header file is made <code>local</code> to each translation unit that includes the header</li>
<li>when inlinin is enabled, the shared fn is inlined at every callsite in order to improve performance, thus givin the best of both worlds</li>
</ol>  </div> </article> </main> </body></html>